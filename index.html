<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover,user-scalable=no">
<title>Scratch Adventure üíï</title>

<style>
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html,body{height:100%;overflow:hidden}
body{
  font-family:Segoe UI,Tahoma,Verdana,sans-serif;
  background:linear-gradient(135deg,#ff9a9e,#fad0c4);
  color:#333;
  position:fixed;width:100%;height:100%
}

/* ===== BACKGROUND ===== */
.particles{position:fixed;inset:0;pointer-events:none;z-index:0}
.particle{position:absolute;border-radius:50%;opacity:.6;animation:float 8s infinite}
.heart{width:14px;height:14px;background:#ff5e78}
.dot{width:10px;height:10px;background:#fff}
@keyframes float{0%{transform:translateY(0)}50%{transform:translateY(-20px)}100%{transform:translateY(0)}}

/* ===== COMMON ===== */
.hidden{display:none!important}
button{cursor:pointer;border:none}

/* ===== WELCOME ===== */
#welcome{
  position:relative;z-index:1;height:100vh;
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;gap:20px;text-align:center
}
#welcome img{width:200px}
#welcome h1{font-size:3em}
.main-btn{
  padding:15px 45px;border-radius:40px;
  background:#ff416c;color:#fff;font-weight:bold
}

/* ===== POPUP BASE ===== */
.popup-bg{
  position:fixed;inset:0;
  background:rgba(0,0,0,.75);
  display:flex;align-items:center;justify-content:center;
  z-index:20
}
.popup{
  background:#fff;
  padding:22px;
  border-radius:18px;
  width:90%;max-width:320px;
  text-align:center
}
.popup button{
  margin-top:10px;
  padding:12px 30px;
  border-radius:25px;
  background:#ff416c;color:#fff;font-weight:bold
}
.share-apps{
  display:flex;justify-content:space-around;
  margin-top:15px;font-size:28px
}

/* ===== GAME ===== */
#game{position:relative;z-index:1;height:100vh;display:flex;flex-direction:column}
.topbar{
  height:60px;display:flex;align-items:center;
  justify-content:space-between;padding:0 15px;
  background:rgba(255,255,255,.25);backdrop-filter:blur(10px)
}
.body{
  flex:1;display:flex;flex-direction:column;
  align-items:center;padding:15px;text-align:center
}
.nameplate{
  background:gold;padding:8px 22px;border-radius:20px;
  font-weight:bold;margin:10px 0
}
.dare-box{
  width:340px;max-width:90%;height:120px;
  border-radius:15px;overflow:hidden;
  position:relative;margin:15px 0;background:#fff
}
#dareText{
  position:absolute;inset:0;
  display:flex;align-items:center;justify-content:center;
  padding:12px;font-weight:bold;text-align:center
}
canvas{position:absolute;inset:0;z-index:2}
#doneBtn{
  padding:14px 40px;border-radius:30px;
  background:#4CAF50;color:#fff;font-weight:bold;margin-top:10px
}
</style>
</head>

<body>

<div class="particles" id="particles"></div>

<!-- WELCOME -->
<div id="welcome">
  <img src="teddy.png">
  <h1>Scratch Adventure</h1>
  <button class="main-btn" onclick="openCreate()">Create Room</button>
  <button class="main-btn" onclick="openJoin()">Join Room</button>
</div>

<!-- CREATE -->
<div class="popup-bg hidden" id="createPop">
  <div class="popup">
    <h3>Create Room</h3>
    <input id="cName" placeholder="Room Name">
    <input id="cPass" placeholder="Password">
    <button onclick="createRoom()">Create</button>
  </div>
</div>

<!-- JOIN -->
<div class="popup-bg hidden" id="joinPop">
  <div class="popup">
    <h3>Join Room</h3>
    <input id="jName" placeholder="Room Name">
    <input id="jPass" placeholder="Password">
    <button onclick="joinRoom()">Join</button>
  </div>
</div>

<!-- INVITE POPUP -->
<div class="popup-bg hidden" id="invitePop">
  <div class="popup">
    <h3>Invite</h3>
    <button onclick="copyLink()">Copy Link</button>
    <div class="share-apps">
      <span onclick="share('whatsapp')">üü¢</span>
      <span onclick="share('instagram')">üü£</span>
      <span onclick="share('snapchat')">üü°</span>
    </div>
    <button onclick="closeInvite()">Cancel</button>
  </div>
</div>

<!-- EXIT POPUP -->
<div class="popup-bg hidden" id="exitPop">
  <div class="popup">
    <h3>Exit Room?</h3>
    <button onclick="confirmExit()">Confirm</button>
    <button onclick="closeExit()">Cancel</button>
  </div>
</div>

<!-- GAME -->
<div id="game" class="hidden">
  <div class="topbar">
    <button onclick="openExit()">‚ùå</button>
    <div>üë§</div>
    <button id="inviteBtn" onclick="openInvite()">üîó</button>
  </div>

  <div class="body">
    <div class="nameplate" id="roomLabel"></div>

    <div class="dare-box">
      <canvas id="scratch"></canvas>
      <div id="dareText">‚ù§Ô∏è Scratch to reveal!</div>
    </div>

    <button id="doneBtn" class="hidden" onclick="done()">Dare Completed</button>
    <div>Created by devherrryyy</div>
  </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
/* PARTICLES */
const p=document.getElementById("particles");
for(let i=0;i<20;i++){
  const d=document.createElement("div");
  d.className="particle "+(Math.random()>.5?"heart":"dot");
  d.style.left=Math.random()*100+"%";
  d.style.top=Math.random()*100+"%";
  p.appendChild(d);
}

/* SOCKET */
const socket=io();
let room="",role="",myTurn=false,scratched=false;

const openCreate=()=>createPop.classList.remove("hidden");
const openJoin=()=>joinPop.classList.remove("hidden");

function createRoom(){socket.emit("create-room",{name:cName.value,password:cPass.value})}
function joinRoom(){socket.emit("join-room",{name:jName.value,password:jPass.value})}

socket.on("room-created",d=>{role=d.role;room=d.room;startGame()});
socket.on("room-joined",d=>{role=d.role;room=d.room;startGame()});

function startGame(){
  welcome.classList.add("hidden");
  createPop.classList.add("hidden");
  joinPop.classList.add("hidden");
  game.classList.remove("hidden");
  roomLabel.textContent=room;
  if(role==="joiner")inviteBtn.classList.add("hidden");
  setupCanvas();
}

/* CANVAS */
const canvas=document.getElementById("scratch");
const ctx=canvas.getContext("2d");
function setupCanvas(){
  canvas.width=340;canvas.height=120;
  ctx.fillStyle="red";
  ctx.fillRect(0,0,340,120);
  ctx.globalCompositeOperation="destination-out";
}
let drawing=false;
canvas.onpointerdown=()=>drawing=true;
canvas.onpointermove=e=>{
  if(!drawing||!myTurn||scratched)return;
  ctx.beginPath();
  ctx.arc(e.offsetX,e.offsetY,18,0,Math.PI*2);
  ctx.fill();
};
canvas.onpointerup=()=>{
  drawing=false;
  if(myTurn&&!scratched){
    scratched=true;
    socket.emit("scratch-complete",room);
  }
};

socket.on("reveal-dare",d=>{
  dareText.textContent=d;
  doneBtn.classList.remove("hidden");
});
socket.on("next-turn",t=>{
  myTurn=(t===role);
  scratched=false;
  doneBtn.classList.add("hidden");
  dareText.textContent="‚ù§Ô∏è Scratch to reveal!";
  setupCanvas();
});

/* INVITE */
function openInvite(){invitePop.classList.remove("hidden")}
function closeInvite(){invitePop.classList.add("hidden")}
function copyLink(){
  navigator.clipboard.writeText(location.href+"?room="+room);
}
function share(app){
  const link=encodeURIComponent(location.href+"?room="+room);
  if(app==="whatsapp")location.href=`https://wa.me/?text=${link}`;
  if(app==="instagram")location.href="https://www.instagram.com/";
  if(app==="snapchat")location.href="https://www.snapchat.com/";
}

/* EXIT */
function openExit(){exitPop.classList.remove("hidden")}
function closeExit(){exitPop.classList.add("hidden")}
function confirmExit(){
  if(role==="creator")socket.emit("exit-room",room);
  location.reload();
}
</script>

</body>
</html>
